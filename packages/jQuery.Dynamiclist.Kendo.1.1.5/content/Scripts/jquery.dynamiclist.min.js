(function(n){var i={mobile:"mobile",kendo:"kendo",ui:"ui"},t={init:function(r){return r=n.extend({},n.fn.dynamiclist.defaults,r),this.each(function(){var u=n(this),c=u.data("dynamiclist"),h,e,f,s,o;c||(u.wrap("<div class='dynamic-list-container ui-widget ui-widget-content ui-corner-all'><\/div>"),u.addClass("dynamic-list"),r.selector=u.selector,r.listType=="table"&&(n("thead tr",u).append("<th><\/th>"),n("tbody tr",u).append("<td class='delete-cell'><\/td>"),n("tfoot tr",u).append("<td><\/td>")),n(r.itemSelector,u).each(function(i){var u=t._getIndexName(r.htmlFieldPrefix,r.property);t._appendRemoveAndIndex(n(this),i,u,r.removeLabel,r.uiType,r.listType,r.itemRemoved)}),r.listType=="table"?(h=u.find("thead td, thead th").length,e=u.find("tfoot"),e.length==0&&(u.append("<tfoot><\/tfoot>"),e=u.find("tfoot")),e.append('<tr><td colspan="'+h+'" class="add-item-container ui-widget-header k-header ui-corner-bottom"><button class="add-item">'+(r.addLabel||"")+"<\/button><\/td><\/tr>")):u.append('<li class="add-item-container ui-widget-header k-header ui-corner-bottom" data-role="list-divider"><button class="add-item">'+(r.addLabel||"")+"<\/button><\/li>"),r.uiType==i.mobile&&(u.attr("data-inset","true"),u.listview()),f=u.find(".add-item"),s=r.addLabel!=null&&r.addLabel!="",r.uiType==i.mobile?f.buttonMarkup({icon:"plus",iconpos:s?"left":"notext"}):r.uiType==i.kendo?f.prepend("<span class='k-icon k-i-plus'><\/span>"):(o={icons:{primary:"ui-icon-new ui-icon-circle-plus"}},s?o.label=r.addLabel:o.text=!1,f.button(o)),f.click(function(){n(this).prop("disabled",!0);var o=t._getNewIndex(u,r.itemSelector),s=t._getNewItemPrefix(r.htmlFieldPrefix,r.property,o),e=r.newItemUrl;return e.indexOf("?")<0&&(e+="?"),n.get(e+"&htmlFieldPrefix="+s,function(e){var h,s,c;r.listType=="table"?(u.find("tbody").append(e),u.find(r.itemSelector+":last").append("<td class='delete-cell'>")):(h=u.find(r.itemSelector+":last"),h.length>0?h.after(e):u.prepend(e)),s=n(r.itemSelector+":last",u),c=t._getIndexName(r.htmlFieldPrefix,r.property),t._appendRemoveAndIndex(s,o,c,r.removeLabel,r.uiType,r.listType,r.itemRemoved),n.validator&&n.validator.unobtrusive&&n.validator.unobtrusive.parseDynamicContent&&n.validator.unobtrusive.parseDynamicContent(s),r.uiType==i.mobile&&(n(n.mobile.textinput.prototype.options.initSelector,s).textinput(),u.listview("refresh")),r.itemAdded&&r.itemAdded(s),f.prop("disabled",!1)}).error(function(n){n.status==401&&alert("Your session has timed out. Please refresh the page and try again.")}),!1}),u.data("dynamiclist",r))})},_appendRemoveAndIndex:function(t,r,u,f,e,o,s){var a='<button type="button" class="delete-item">'+(f||"")+"<\/button>",v='<input type="hidden" name="'+u+'" class="index" value="'+r+'" />',h=a+v,c,l;o=="table"?t.find("td.delete-cell").append(h):t.append(h),n(".delete-item",t).click(function(){t.remove(),s&&s(t)}),c=f!=null&&f!="",e==i.mobile?n(".delete-item",t).buttonMarkup({icon:"delete",iconpos:"notext",inline:"true"}):e==i.kendo?n(".delete-item",t).prepend("<span class='k-icon k-i-cancel'><\/span>"):(l={text:c,label:f,icons:{primary:"ui-icon-delete ui-icon-trash"}},n(".delete-item",t).button(l))},_getBaseItemPrefix:function(n,t){var i=n;return i!=""&&(i+="."),i+=t},_getNewItemPrefix:function(n,i,r){return t._getBaseItemPrefix(n,i)+"["+r+"]"},_getIndexName:function(n,i){return t._getBaseItemPrefix(n,i)+".Index"},_getNewIndex:function(t,i){var u=n(i,t),r;return u.length==0?0:(r=0,u.each(function(){var t=parseInt(n("input.index",n(this)).val());isNaN(t)&&(t=0),r=Math.max(r,t)}),r+1)},options:function(t){return this.each(function(){var i=n(this),r=i.data("dynamiclist")||{};t=n.extend({},r,t),i.dynamiclist("destroy").dynamiclist("init",t)})},add:function(){return this.each(function(){var t=n(this);t.find(".add-item").click()})},destroy:function(){return this.each(function(){var t=n(this);t.removeData("dynamiclist")})}};n.fn.dynamiclist=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on jQuery.dynamiclist");else return t.init.apply(this,arguments)},n.fn.dynamiclist.defaults={uiType:typeof n.mobile!="undefined"?"mobile":typeof kendo!="undefined"?"kendo":"ui",itemSelector:".item",addLabel:"Additional",removeLabel:"Remove",htmlFieldPrefix:"",property:"Items",newItemUrl:"NewItem",listType:"list",itemAdded:function(){},itemRemoved:function(){}}})(jQuery)